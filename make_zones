#!/usr/bin/perl
use strict;
use File::Find::Rule;
use File::Basename ;
use File::Path;
use Carp;

# we expect that you've generated the zone as .ics files into a
# directory called zoneinfo using vzic
# http://dialspace.dial.pipex.com/prod/dialspace/town/pipexdsl/s/asbm26/vzic/

for my $infile (find( file => name => '*.ics', in => 'zoneinfo' )) {
    my $zone = $infile;
    $zone =~ s{^zoneinfo/}{};
    $zone =~ s{\.ics$}{};
    my $module = "Data::ICal::TimeZone::$zone";
    $module =~ s{/}{::}g;
    my $outfile = "lib/$module.pm";
    $outfile =~ s{::}{/}g;
    print "$zone => $module => $outfile\n";
    mkpath [ dirname $outfile ];
    open my $out, '>',  $outfile or croak "open $outfile $!";
    open my $in, '<', $infile or croak "open $infile $1";
    print {$out} <<"END";
package $module;
use strict;
use base qw( Data::ICal::TimeZone );

=head1 NAME

$module - ics version of $zone

=head1 DESCRIPTION

This is a autogenerated datafile

=cut

__DATA__
END

    print {$out} <$in>;
}
